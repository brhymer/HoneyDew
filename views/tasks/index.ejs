<%- include("../partials/_head")%>

<main>
    <h1>Tasks</h1>
    <%if(locals.error) {%>
        <%-include("../partials/_errorAlert", {error: error})%>
    <%}%>

    <a href="/tasks/new">Create New Task</a>
    <%if(tasks.length > 0){%>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Due Date</th>
                <th scope="col">Edit</th>
                <th scope="col">Delete</th>
                <th scope="col">Updated</th>
            </tr>
        </thead>
        <tbody>
            <%tasks.forEach((task) =>{%>
                <tr>
                    <th scope="row"><%=tasks.indexOf(task) + 1%></th>
                    <td><a href="/tasks/<%=task.id%>"><%=task.title%></a></td>
                    <td><%=task.dueDate.toDateString()%></td>
                    <td><a class="btn btn-primary btn-sm" href="/tasks/edit/<%=task._id%>">Edit</a></td>
                    <td><form action="/tasks/<%=task._id%>?_method=DELETE" method="POST"><button class="btn btn-danger btn-sm"type="submit">Delete</button></form></td>
                    <td><%=new Date(task.updatedAt).toDateString()%></td>
                </tr>
            <%})%>
        </tbody>
    </table>
    <% } else {%>
        <p>You don't have any tasks, ya lazy bum</p>
    <% } %> 

</main>

<%- include("../partials/_footer")%>